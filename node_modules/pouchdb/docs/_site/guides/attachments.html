<!DOCTYPE html>
<html lang="en" manifest="/manifest.appcache">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Working with attachments</title>
    <link rel="alternate" title="PouchDB, the JavaScript Database that Syncs!" type="application/rss+xml" href="/feed.xml">
    <link rel="stylesheet" href="/static/css/pouchdb.css" />
    <meta name="theme-color" content="#6ccb99">
    <meta name="msapplication-TileColor" content="#6ccb99">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-42479701-1']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700|Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon"/>
  </head>

  <body data-spy="scroll" data-target="#sidebar">

    <header role="banner">

      <a href="https://github.com/pouchdb/pouchdb" target="_blank">
         <div class="ribbon">GitHub</div>
      </a>

      <div class="container">

        <a class="logo" href="/">
          <div class="logo-img"></div>
          <span class='logo-type'>PouchDB</span>
        </a>

        <ul class='nav nav-header nav-pills' role="navigation">
          <li>
            <a class='btn btn-link btn-lg' href="/blog/">Blog</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/guides/">Guides</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/api.html">API</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/learn.html">Learn</a>
          </li>
          <li>
            <a
                class='btn btn-primary btn-lg'
                href="https://github.com/pouchdb/pouchdb/releases/download/5.2.0/pouchdb-5.2.0.min.js"
            >
                Download <strong>v5.2.0</strong>
            </a>
          </li>
        </ul>

      </div>

    </header>
    
      <div class="page-head">

        <div class="container">

          <h1 class="page-title">Working with attachments</h1>
          
            <span class="h1">
              
  

<a
  data-toggle="tooltip"
  data-placement="top"
  title="Edit this on Github"
  class="icon-edit"
  href="https://github.com/pouchdb/pouchdb/edit/master/docs/_guides/attachments.md"
  target="_blank"
></a>

            </span>
          
          

        </div>

      </div>
    

    <div role="main">
      <article>
  <div class="container">
    <div class="row">
        <div id="sidebar" class="col-sm-3 nav-sidebar-wrapper">
          <ul class="nav nav-silent nav-sidebar" role="navigation">
            

    
    
        
    
    <li >
    <a href="/guides/">Intro</a>
</li>


    
    
    <li >
    <a href="/guides/setup-couchdb.html">Setting up CouchDB</a>
</li>


    
    
    <li >
    <a href="/guides/setup-pouchdb.html">Setting up PouchDB</a>
</li>


    
    
    <li >
    <a href="/guides/databases.html">Working with databases</a>
</li>


    
    
    <li >
    <a href="/guides/documents.html">Working with documents</a>
</li>


    
    
    <li >
    <a href="/guides/async-code.html">Asynchronous code</a>
</li>


    
    
        
    
    <li >
    <a href="/guides/updating-deleting.html">Updating/deleting documents</a>
</li>


    
    
    <li >
    <a href="/guides/bulk-operations.html">Bulk operations</a>
</li>


    
    
    <li  class="active" >
    <a href="/guides/attachments.html">Working with attachments</a>
</li>


    
    
    <li >
    <a href="/guides/replication.html">Replication</a>
</li>


    
    
    <li >
    <a href="/guides/conflicts.html">Conflicts</a>
</li>


    
    
    <li >
    <a href="/guides/changes.html">Changes feed</a>
</li>


    
    
    <li >
    <a href="/guides/queries.html">Map/reduce queries</a>
</li>


    
    
    <li >
    <a href="/guides/compact-and-destroy.html">Compacting and destroying</a>
</li>


    
    
    <li >
    <a href="/guides/local-documents.html">Local documents</a>
</li>



          </ul>
        </div>

        <div class="col-sm-9" role="main">
          <p>Attachments are where PouchDB can get really fun.</p>

<p>The big difference between storage engines like WebSQL/IndexedDB and the older localStorage API is that you can stuff <a href="http://www.html5rocks.com/en/tutorials/offline/quota-research/">a lot more data</a> in it.</p>

<p>PouchDB attachments allow you to use that to full advantage to store images, MP3s, zip files, or whatever you want.</p>

<div id='how-attachments-are-stored'></div>

<p><a class='h2 anchor' href='#how-attachments-are-stored' name='how-attachments-are-stored'>
How attachments are stored
</a></p>

<p>As their name implies, attachments are <em>attached</em> to documents. You can work with attachments either in base64-encoded format, or as a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob">Blob</a>.</p>

<p>For example, here is a very simple document with a plain text attachment, stored as base64.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;mydoc&#39;</span><span class="p">,</span>
  <span class="nx">_attachments</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;myattachment.txt&#39;</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">content_type</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="s1">&#39;aGVsbG8gd29ybGQ=&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>Our document has the usual <code>_id</code> field, but it also has a special <code>_attachments</code> field that holds the attachments. Documents can have as many attachments as you want.</p>

<div class="alert alert-info">


<div class="alert-text">


When you create an attachment, you need to specify its <code>content_type</code>, otherwise known as the <a href='https://en.wikipedia.org/wiki/MIME'>MIME type</a>. Common MIME types include <code>'text/plain'</code> for plain text, <code>'image/png'</code> for PNG images, and <code>'image/jpeg'</code> for JPG images.

</div></div>

<p>As it turns out, <code>&#39;aGVsbG8gd29ybGQ=&#39;</code> is just the string <code>&#39;hello world&#39;</code> encoded in base64. You can use the <code>atob()</code> and <code>btoa()</code> methods in your browser to verify.</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">btoa</span><span class="p">(</span><span class="s1">&#39;hello world&#39;</span><span class="p">)</span>      <span class="c1">// &quot;aGVsbG8gd29ybGQ=&quot;</span>
<span class="nx">atob</span><span class="p">(</span><span class="s1">&#39;aGVsbG8gd29ybGQ=&#39;</span><span class="p">)</span> <span class="c1">// &quot;hello world&quot;</span>
</code></pre></div>
<p>Let&#39;s see what happens after we store this document. If you try to <code>get()</code> it normally, you may be surprised to see that the attachment data itself isn&#39;t returned:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>The returned document will look like this:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;myattachment.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
      <span class="s2">&quot;digest&quot;</span><span class="o">:</span> <span class="s2">&quot;md5-XrY7u+Ae7tCTyyK7j1rNww==&quot;</span><span class="p">,</span>
      <span class="s2">&quot;stub&quot;</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-e8a84187bb4e671f27ec11bdf7320aaa&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>You can see <strong><a href="http://bl.ocks.org/nolanlawson/0a4b1267d3a5b5edd7b1">a live example</a></strong> of this code.</p>

<p>By default, PouchDB will only give you an attachment <strong>stub</strong>, which contains a <code>digest</code>, i.e. the <a href="http://en.wikipedia.org/wiki/Md5sum">md5sum</a> of the binary attachment.</p>

<p>To get the full attachments when using <code>get()</code> or <code>allDocs()</code>, you need to specify <code>{attachments: true}</code>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">attachments</span><span class="o">:</span> <span class="kc">true</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>Then you&#39;ll get back the full attachment, base64-encoded:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">{</span>
  <span class="s2">&quot;_attachments&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;myattachment.txt&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;content_type&quot;</span><span class="o">:</span> <span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
      <span class="s2">&quot;digest&quot;</span><span class="o">:</span> <span class="s2">&quot;md5-XrY7u+Ae7tCTyyK7j1rNww==&quot;</span><span class="p">,</span>
      <span class="s2">&quot;data&quot;</span><span class="o">:</span> <span class="s2">&quot;aGVsbG8gd29ybGQ=&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;mydoc&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-e8a84187bb4e671f27ec11bdf7320aaa&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>You can see <strong><a href="http://bl.ocks.org/nolanlawson/b6d6164035f1fa0d38a8">a live example</a></strong> of this code.</p>

<div id='image-attachments'></div>

<p><a class='h2 anchor' href='#image-attachments' name='image-attachments'>
Image attachments
</a></p>

<p>Plaintext is cool and all, but you know what would be <em>really</em> awesome? Storing images.</p>

<p>So let&#39;s do it! In this example, we&#39;ll put a document with a small icon attachment, represented as a base64-encoded string. Then we&#39;ll fetch it and display the icon as a normal <code>&lt;img&gt;</code> tag:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;meowth&#39;</span><span class="p">,</span>
  <span class="nx">_attachments</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;meowth.png&#39;</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">content_type</span><span class="o">:</span> <span class="s1">&#39;image/png&#39;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="s1">&#39;iVBORw0KGgoAAAANSUhEUgAAACgAAAAkCAIAAAB0Xu9BAAAABGdBTUEAALGPC/xhBQAAAuNJREFUWEetmD1WHDEQhDdxRMYlnBFyBIccgdQhKVcgJeQMpE5JSTd2uqnvIGpVUqmm9TPrffD0eLMzUn+qVnXPwiFd/PP6eLh47v7EaazbmxsOxjhTT88z9hV7GoNF1cUCvN7TTPv/gf/+uQPm862MWTL6fff4HfDx4S79/oVAlAUwqOmYR0rnazuFnhfOy/ErMKkcBFOr1vOjUi2MFn4nuMil6OPh5eGANLhW3y6u3aH7ijEDCxgCvzFmimvc95TekZLyMSeJC68Bkw0kqUy1K87FlpGZqsGFCyqEtQNDdFUtFctTiuhnPKNysid/WFEFLE2O102XJdEE+8IgeuGsjeJyGHm/xHvQ3JtKVsGGp85g9rK6xMHtvHO9+WACYjk5vkVM6XQ6OZubCJvTfPicYPeHO2AKFl5NuF5UK1VDUbeLxh2BcRGKTQE3irHm3+vPj6cfCod50Eqv5QxtwBQUGhZhbrGVuRia1B4MNp6edwBxld2sl1splfHCwfsvCZfrCQyWmX10djjOlWJSSy3VQlS6LmfrgNvaieRWx1LZ6s9co+P0DLsy3OdLU3lWRclQsVcHJBcUQ0k9/WVVrmpRzYQzpgAdQcAXxZzUnFX3proannrYH+Vq6KkLi+UkarH09mC8YPr2RMWOlEqFkQClsykGEv7CqCUbXcG8+SaGvJ4a8d4y6epND+pEhxoN0vWUu5ntXlFb5/JT7JfJJqoTdy9u9qc7ax3xJRHqJLADWEl23cFWl4K9fvoaCJ2BHpmJ3s3z+O0U/DmzdMjB9alWZtg4e3yxzPa7lUR7nkvxLHO9+tvJX3mtSDpwX8GajB283I8R8a7D2MhUZr1iNWdny256yYLd52DwRYBtRMvE7rsmtxIUE+zLKQCDO4jlxB6CZ8M17GhuY+XTE8vNhQiIiSE82ZsGwk1pht4ZSpT0YVpon6EvevOXXH8JxVR78QzNuamupW/7UB7wO/+7sG5V4ekXb4cL5Lyv+4IAAAAASUVORK5CYII=&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">getAttachment</span><span class="p">(</span><span class="s1">&#39;meowth&#39;</span><span class="p">,</span> <span class="s1">&#39;meowth.png&#39;</span><span class="p">);</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">blob</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">);</span>
  <span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">img</span><span class="p">);</span>
<span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p>You can see <strong><a href="http://bl.ocks.org/nolanlawson/2a5f98a66c9fe3ae3532">a live example</a></strong> of this code.</p>

<p>You should be unsurprised to see a cat smiling back at you. If the kitten theme bothers you, then you haven&#39;t been on the Internet very long.</p>

<p>How does this code work? First off, we are making use of the <code>URL.createObjectURL()</code> method, which is a standard HTML5 method that converts a <code>Blob</code> to a URL that we can easily use as the <code>src</code> of an <code>img</code>.</p>

<p>Second off, we are using the <code>getAttachment()</code> API, which returns a <code>Blob</code> rather than a base64-encoded string. To be clear: we can always convert between base64 and <code>Blob</code>s, but in this case, <code>getAttachment()</code> is just more convenient.</p>

<div id='directly-storing-binary-data'></div>

<p><a class='h2 anchor' href='#directly-storing-binary-data' name='directly-storing-binary-data'>
Directly storing binary data
</a></p>

<p>Up to now, we&#39;ve been supplying our attachments as base64-encoded strings. But we can also create the Blobs ourselves and store those directly in PouchDB.</p>

<p>Another shortcut we can use is the <code>putAttachment()</code> API, which simply modifies the existing document to hold a new attachment. Or, if the document does not exist, it will create an empty one.</p>

<div class="alert alert-info">


<div class="alert-text">


In <strong>Node.js</strong>, PouchDB uses <a href='http://nodejs.org/api/buffer.html'>Buffers</a> instead of Blobs. Otherwise, the same rules apply.

</div></div>

<p>For instance, we can read the image data from an <code>&lt;img&gt;</code> tag using a <code>canvas</code> element, and then directly write that Blob to PouchDB:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">function</span> <span class="nx">convertImgToBlob</span><span class="p">(</span><span class="nx">img</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">);</span>
   <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
   <span class="nx">context</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">img</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="c1">// Warning: toBlob() isn&#39;t supported by every browser.</span>
    <span class="c1">// You may want to use blob-util.</span>
   <span class="nx">canvas</span><span class="p">.</span><span class="nx">toBlob</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="s1">&#39;image/png&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">catImage</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">);</span>
<span class="nx">convertImgToBlob</span><span class="p">(</span><span class="nx">catImage</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">blob</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">&#39;meowth&#39;</span><span class="p">,</span> <span class="s1">&#39;meowth.png&#39;</span><span class="p">,</span> <span class="nx">blob</span><span class="p">,</span> <span class="s1">&#39;image/png&#39;</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;meowth&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">attachments</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
  <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doc</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>You can see <strong><a href="http://bl.ocks.org/nolanlawson/edaf09b84185418a55d9">a live example</a></strong> of this code.</p>

<p>This stores exactly the same image content as in the other example, which you can confirm by checking the base64-encoded output.</p>

<div class="alert alert-warning">


<div class="alert-text">


Blobs can be tricky to work with, especially when it comes to cross-browser support.
You may find <a href='https://github.com/nolanlawson/blob-util'>blob-util</a> to be a useful
addition to the attachment API. For instance, it has an
<code>imgSrcToBlob()</code> method that will work cross-browser.

</div></div>

<div id='allow-the-user-to-store-an-attachment'></div>

<p><a class='h2 anchor' href='#allow-the-user-to-store-an-attachment' name='allow-the-user-to-store-an-attachment'>
Allow the user to store an attachment
</a></p>

<p>You can also upload a file with the HTML5 <code>File</code> API and store it directly in the database, because the data you get from the <code>&lt;input type=&quot;file&quot;&gt;</code> element is already a <code>Blob</code>.
(See: <a href="https://developer.mozilla.org/en-US/docs/Web/API/Blob">Blob API</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/File">File API</a>, which inherits properties from the <code>Blob</code> Interface.)</p>

<p>Here is an example of allowing a user to choose a file from their filesystem:</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;file&quot;</span><span class="nt">&gt;</span>
</code></pre></div>
<p>And then &quot;uploading&quot; that file directly into PouchDB:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">);</span>
<span class="nx">input</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">input</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span> <span class="c1">// file is a Blob</span>

  <span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
    <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;mydoc&#39;</span><span class="p">,</span>
    <span class="nx">_attachments</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">filename</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">type</span><span class="o">:</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span><span class="p">,</span>
        <span class="nx">data</span><span class="o">:</span> <span class="nx">file</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<p>You can see <strong><a href="http://bl.ocks.org/ntwcklng/f57b03c15e91c25e2cb5">a live example</a></strong> of this code.</p>

<p>Select a file and you will see the stored file, <code>size</code>, and <code>type</code>, which are valid <code>Blob</code> properties. If you choose an image, it will also show the image!</p>

<div id='base64-vs-blobs-buffers'></div>

<p><a class='h2 anchor' href='#base64-vs-blobs-buffers' name='base64-vs-blobs-buffers'>
Base64 vs Blobs/Buffers
</a></p>

<p>Whether you supply attachments as base64-encoded strings or as Blobs/Buffers, PouchDB will try to store them in <a href="/faq.html#data_types">the most efficient way</a>.</p>

<p>So when you insert your attachments, either format is acceptable. For instance, you can put Blobs/Buffers using <code>put()</code>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;mydoc&#39;</span><span class="p">,</span>
  <span class="nx">_attachments</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;myattachment.txt&#39;</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">content_type</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="nx">myBlob</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>And you can also pass base64-encoded strings to <code>putAttachment()</code>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">putAttachment</span><span class="p">(</span><span class="s1">&#39;mydoc&#39;</span><span class="p">,</span> <span class="s1">&#39;myattachment.png&#39;</span><span class="p">,</span> <span class="nx">myBase64String</span><span class="p">,</span> <span class="s1">&#39;image/png&#39;</span><span class="p">);</span>
</code></pre></div>
<p>You can also insert multiple attachments at once using <code>put()</code>:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;mydoc&#39;</span><span class="p">,</span>
  <span class="nx">_attachments</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;myattachment1.txt&#39;</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">content_type</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="nx">myBlob1</span>
    <span class="p">},</span>
    <span class="s1">&#39;myattachment2.txt&#39;</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">content_type</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="nx">myBlob2</span>
    <span class="p">},</span>
    <span class="s1">&#39;myattachment3.txt&#39;</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">content_type</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="nx">myBlob3</span>
    <span class="p">},</span>
    <span class="c1">// etc.</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>The <code>bulkDocs()</code> and <code>post()</code> APIs also accept attachments in either format.</p>

<p>When you fetch attachments, however, <code>getAttachment()</code> will always return Blobs/Buffers.</p>

<p>The other &quot;read&quot; APIs, such as <code>get()</code>, <code>allDocs()</code>, <code>changes()</code>, and <code>query()</code> have an <code>{attachments: true}</code> option that returns the attachments base64-encoded strings. If you add <code>{binary: true}</code>, though, they will return Blobs/Buffers.</p>

<div id='blob-types'></div>

<p><a class='h2 anchor' href='#blob-types' name='blob-types'>
Blob types
</a></p>

<p>Blobs have their own <code>type</code>, but there is also a <code>content_type</code> that you specify when you store it in PouchDB:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">var</span> <span class="nx">myBlob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="s1">&#39;I am plain text!&#39;</span><span class="p">],</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">});</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">myBlob</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span> <span class="c1">// &#39;text/plain&#39;</span>

<span class="nx">db</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
  <span class="nx">_id</span><span class="o">:</span> <span class="s1">&#39;mydoc&#39;</span><span class="p">,</span>
  <span class="nx">_attachments</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;myattachment.txt&#39;</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">content_type</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="nx">myBlob</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p>The reason for this redundancy is 1) Buffers in Node do not have a <code>type</code>, and 2) the CouchDB attachment format requires it.</p>

<p>So for best results, you should ensure that your Blobs have the same type as the one reported to PouchDB. Otherwise you may see inconsistent behavior (e.g. in IndexedDB, where the Blob is stored as-is on compatible browsers).</p>

<div id='related-api-documentation'></div>

<p><a class='h2 anchor' href='#related-api-documentation' name='related-api-documentation'>
Related API documentation
</a></p>

<ul>
<li><a href="/api.html#save_attachment">putAttachment()</a></li>
<li><a href="/api.html#get_attachment">getAttachment()</a></li>
<li><a href="/api.html#delete_attachment">removeAttachment()</a></li>
</ul>

<div id='next'></div>

<p><a class='h2 anchor' href='#next' name='next'>
Next
</a></p>

<p>Now that you can attach cat pictures to all your documents (and why wouldn&#39;t you?), let&#39;s talk about replication.</p>




    

    

    

    

    

    

    

    

    
        
        

        <ul class="pager">
            
                <li class="previous">
                    <a href="/guides/bulk-operations.html">&larr; Bulk operations</a>
                </li>
            
            
                <li class="next">
                    <a href="/guides/replication.html">Replication &rarr;</a>
                </li>
            
        </ul>
    

    

    

    

    

    

    


        <div>

    </div>

  </div>

</article>

    </div>

    <div class="icons">

      <div class="container">

        <div class="row">

          <div class='col-xs-4 col-md-offset-0 col-md-2'>
            <a href='https://twitter.com/pouchdb' target='_blank'>
              <div class="icon icon-twitter"></div>
              <span class="sr-only">PouchDB's Twitter</span>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://github.com/rvagg/node-levelup' target='_blank'>
              <div class="icon icon-leveldb"></div>
              <span class="sr-only">Node Levelup</span>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://github.com/pouchdb/pouchdb' target='_blank'>
              <div class="icon icon-github"></div>
              <span class="sr-only">PouchDB's Github Repo</span>
            </a>
            </div>

          <div class='col-xs-4 col-md-offset-0 col-md-2'>
            <a href='https://travis-ci.org/pouchdb/pouchdb' target='_blank'>
              <div class="icon icon-travis"></div>
              <span class="sr-only">PouchDB's Travis CI</span>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='http://couchdb.apache.org/' target='_blank'>
              <div class="icon icon-couchdb"></div>
              <span class="sr-only">CouchDB</span>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://saucelabs.com' target='_blank'>
              <div class="icon icon-saucelabs"></div>
              <span class="sr-only">Saucelabs</span>
            </a>
          </div>

        </div>

      </div>

    </div>

    <footer class="footer">

      <div class="container">

        <div class="row">

          <div class='col-sm-3'>
            <h3 class="nav-head">Learn</h3>
            <ul class='nav nav-silent'>
              <li><a href="/getting-started.html">Getting Started</a></li>
              <li><a href="/api.html">API Guide</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/wiki">Wiki</a></li>
            </ul>
          </div>

          <div class='col-sm-3'>
            <h3 class="nav-head">Discuss</h3>
            <ul class='nav nav-silent'>
              <li><a href="https://groups.google.com/forum/#!forum/pouchdb">Mailing List</a></li>
              <li><a href="irc://freenode.net/#pouchdb">IRC</a></li>
              <li><a href="http://twitter.com/pouchdb">Twitter</a></li>
              <li><a href="http://stackoverflow.com/questions/tagged/pouchdb">StackOverflow</a></li>
            </ul>
          </div>

          <div class='col-sm-3'>
            <h3 class="nav-head">Contribute</h3>
            <ul class='nav nav-silent'>
              <li><a href="https://github.com/pouchdb/pouchdb/blob/master/CONTRIBUTING.md">Contributing</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb">Source</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/issues">Issues</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/blob/master/LICENSE">Apache License</a></li>
            </ul>
          </div>

        </div>

      </div>

    </footer>
    <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/js/code.min.js"></script>
    <script type="text/javascript" src="/static/js/stickyfill.min.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/pouchdb/latest/pouchdb.min.js"></script>
    <script type="text/javascript">
      var $navSidebarWrapper = $('.nav-sidebar-wrapper');
      if ($navSidebarWrapper.length) {
        $navSidebarWrapper.Stickyfill();
      }
      $('[data-toggle="tooltip"]').tooltip();
      function onCached(e) {
        if (applicationCache.status === 1) {
          giveIntro();
        }
      }

      function giveIntro() {
        console.log('%c\n..............................................................................\n.?I...........~+: ............................................................\n.???.........++++.............................................................\n:????+......+++++.............................................................\n.??????+++++++++:.................................H...........D..B............\n...????++++++++...................................H...........D..B............\n...=????++++++.......PPPPP...OOOO...U....U...CCCC.HHHHH...DDDDD..BBBBB........\n...?????+++++++......P...:P.OO...O..U....U..C.....H...H..D....D..B....B.......\n..???????+++++++ ....P. ..P.O....O..U....U.CC.....H...H..D....D..B....B.......\n..?????????????......P...:P.OO...O..U....U..C.....H...H..D....D..B....B.......\n...I??????????~......PPPPP...OOOO...=UUUUU...CCCC.H...H...DDDDD..BBBBB........\n....?????????~.......P.... ...................................................\n.....???????+........P........................................................\n......??????..................................................................\n..............................................................................\n..............................................................................\n..............................................................................', 'color: #4ec084');
        console.log('%c\nPouchDB itself is hosted at PouchDB.com!\nTo get started, try typing:\nvar db = new PouchDB(\'mydb\');', 'color: #4ec084');
      }
      function offerToReload() {
        $('.js-update-notification')
          .removeClass('btn-update-hidden')
          .on('click', function(){
            window.location.reload();
          });
      }
      if (window.applicationCache) {
        applicationCache.addEventListener('cached', onCached, false);
        applicationCache.addEventListener('noupdate', giveIntro, false);
        applicationCache.addEventListener('updateready', offerToReload, false);
      }
    </script>
    <button type="button" class="js-update-notification btn btn-primary btn-update btn-update-hidden">
      Content updated, reload now? ↻
    </button>
  </body>
</html>
