<!DOCTYPE html>
<html lang="en" manifest="/manifest.appcache">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>PouchDB 4.0.0 - Ballast Overboard</title>
    <link rel="alternate" title="PouchDB, the JavaScript Database that Syncs!" type="application/rss+xml" href="/feed.xml">
    <link rel="stylesheet" href="/static/css/pouchdb.css" />
    <meta name="theme-color" content="#6ccb99">
    <meta name="msapplication-TileColor" content="#6ccb99">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-42479701-1']);
      _gaq.push(['_trackPageview']);

      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <link href='http://fonts.googleapis.com/css?family=Lato:400,700|Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon"/>
  </head>

  <body data-spy="scroll" data-target="#sidebar">

    <header role="banner">

      <a href="https://github.com/pouchdb/pouchdb" target="_blank">
         <div class="ribbon">GitHub</div>
      </a>

      <div class="container">

        <a class="logo" href="/">
          <div class="logo-img"></div>
          <span class='logo-type'>PouchDB</span>
        </a>

        <ul class='nav nav-header nav-pills' role="navigation">
          <li>
            <a class='btn btn-link btn-lg' href="/blog/">Blog</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/guides/">Guides</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/api.html">API</a>
          </li>
          <li>
            <a class='btn btn-link btn-lg' href="/learn.html">Learn</a>
          </li>
          <li>
            <a
                class='btn btn-primary btn-lg'
                href="https://github.com/pouchdb/pouchdb/releases/download/5.2.0/pouchdb-5.2.0.min.js"
            >
                Download <strong>v5.2.0</strong>
            </a>
          </li>
        </ul>

      </div>

    </header>
    
      <div class="page-head">

        <div class="container">

          <h1 class="page-title">PouchDB 4.0.0 - Ballast Overboard</h1>
          
            <span class="h1">
              
  

<a
  data-toggle="tooltip"
  data-placement="top"
  title="Edit this on Github"
  class="icon-edit"
  href="https://github.com/pouchdb/pouchdb/edit/master/docs/_posts/2015-08-03-pouchdb-4.0.0-ballast-overboard.md"
  target="_blank"
></a>

            </span>
          
          

        </div>

      </div>
    

    <div role="main">
      <article class='container'>
  <div class='row'>
    <article class='col-md-offset-1 col-md-10' role="article">
      
  







  

  

  
    
      
    
    
      
    
  

  

  




<div class="post">
  <div class="media">
    <a class="pull-left" href="#">
    <img class="media-object img-circle img-responsive" src='https://gravatar.com/avatar/030451d8cfc268d666bae9a7fe8d10ec' alt='Dale Harvey'>
    </a>
    <div class="media-body">
    <p>
      <strong>By:</strong> <a href="https://twitter.com/daleharvey">Dale Harvey</a><br>
      <strong>Published:</strong> 03 August 2015<br>
      
    </p>
    </div>
  </div>
</div>


      <blockquote>
<p>When discussing what features we should add,
we should also discuss what to remove. - possibly Joe Armstrong</p>
</blockquote>

<p>I can&#39;t remember or find the exact quote, but it was something along those lines. We try to maintain backwards compatibility as much as possible with PouchDB, however sometimes we need to let go of those features that just didn&#39;t work out like planned. We have previously marked quite a few things as deprecated, and in this 4.0.0 release we have finally removed them along with our usual slew of bugfixes, improvements and new features.</p>

<h3>Deprecations</h3>

<ul>
<li>Remove <code>bluebird</code> and use <code>lie</code> as only <code>Promise</code> polyfill - (<a href="https://github.com/pouchdb/pouchdb/issues/3839">#3839</a>)</li>
</ul>

<p>We previously used <code>bluebird</code> as our <code>Promise</code> polyfill in node.js because it is a fast library. However <code>bluebird</code> contains a lot of non-standard <code>Promise</code> functionality, which authors could use and then have their code break in browsers as well as iojs and future versions of node.js, which have introduced a standard <code>Promise</code> implementation.</p>

<p>PouchDB will always use the globally available <code>Promise</code> object where available, so if you have only used standard <code>Promise</code> functionality, this change will not break anything. If you require the extra functionality provided by <code>bluebird</code>, then you can have PouchDB use it with</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">global</span><span class="p">.</span><span class="nx">Promise</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bluebird&#39;</span><span class="p">);</span>
</code></pre></div>
<ul>
<li>Remove <code>local_seq</code> - (<a href="https://github.com/pouchdb/pouchdb/issues/4080">#4080</a>)</li>
</ul>

<p>This was a little-used functionality whose semantics are due to change in CouchDB 2.0.</p>

<ul>
<li>Remove <code>onChange</code> and <code>complete</code> callbacks - (<a href="https://github.com/pouchdb/pouchdb/issues/4098">#4098</a>)</li>
</ul>

<p>These callbacks have long been replaced with the <code>EventEmitter</code>-style <code>changes()</code>, <code>replicate()</code> and <code>sync()</code> APIs, and are finally being removed. If you still have:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">({</span>
  <span class="nx">onChange</span><span class="o">:</span> <span class="nx">changeFun</span><span class="p">,</span>
  <span class="nx">complete</span><span class="o">:</span> <span class="nx">completeFun</span>
<span class="p">});</span>
</code></pre></div>
<p>You can replace them with:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">db</span><span class="p">.</span><span class="nx">changes</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">changeFun</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;complete&#39;</span><span class="p">,</span> <span class="nx">completeFun</span><span class="p">);</span>
</code></pre></div>
<ul>
<li>Remove <code>uptodate</code> event - (<a href="https://github.com/pouchdb/pouchdb/issues/4100">#4100</a>)</li>
</ul>

<p><code>uptodate</code> was an event introduced to indicate when a <code>live</code> replication had finished processing all current changes and was waiting on future changes. It has since been replaced by the <code>paused</code> event, which will do the same and additionally indicate whether the replication was paused due to an error. If you have:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">replication</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;uptodate&#39;</span><span class="p">,</span> <span class="nx">doneFun</span><span class="p">);</span>
</code></pre></div>
<p>You can replace it with:</p>
<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">replication</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;paused&#39;</span><span class="p">,</span> <span class="nx">doneFun</span><span class="p">);</span>
</code></pre></div>
<h3>New features</h3>

<ul>
<li>Return Blobs (or Buffers) in <code>get()</code> + <code>allDocs()</code> + <code>changes()</code> + <code>query()</code> with <code>{binary: true}</code> (<a href="https://github.com/pouchdb/pouchdb/issues/2858">#2858</a>)</li>
<li>Allow chaining of plugin registration (<a href="https://github.com/pouchdb/pouchdb/issues/3943">#3943</a>)</li>
<li>Allow option to raise timeouts in changes / replication (<a href="https://github.com/pouchdb/pouchdb/issues/4022">#4022</a>)</li>
<li>Add direct edit button to website (<a href="https://github.com/pouchdb/pouchdb/issues/3747">#3747</a>)</li>
</ul>

<h3>Bugfixes</h3>

<ul>
<li>Fix attachment length for stubs (<a href="https://github.com/pouchdb/pouchdb/issues/3963">#3963</a>)</li>
<li>Reduce the number of checkpoint mismatches (<a href="https://github.com/pouchdb/pouchdb/issues/4009">#4009</a>)</li>
<li>Fallback from checkpoint mismatch correctly (less replication start from the beginning) (<a href="https://github.com/pouchdb/pouchdb/issues/3999">#3999</a>)</li>
<li>Dont fail replication when attachment request fails (<a href="https://github.com/pouchdb/pouchdb/issues/4021">#4021</a>)</li>
<li>Fix check for <code>localStorage</code> in Safari private mode (<a href="https://github.com/pouchdb/pouchdb/issues/4070">#4070</a>)</li>
</ul>

<h3>Coverage improvements</h3>

<ul>
<li>Large number of new tests and dead code removed to increase our <a href="https://coveralls.io/github/pouchdb/pouchdb/">test coverage</a> - (<a href="https://github.com/pouchdb/pouchdb/issues/4071">#4071</a>)</li>
</ul>

<h3>Get in touch</h3>

<p>Please <a href="https://github.com/pouchdb/pouchdb/issues">file issues</a> or <a href="https://github.com/pouchdb/pouchdb/blob/master/CONTRIBUTING.md#get-in-touch">tell us what you think</a>. And as always, a big thanks to all of our <a href="https://github.com/pouchdb/pouchdb/graphs/contributors">new and existing contributors</a>!</p>

    </article>
  </div>
</article>

    </div>

    <div class="icons">

      <div class="container">

        <div class="row">

          <div class='col-xs-4 col-md-offset-0 col-md-2'>
            <a href='https://twitter.com/pouchdb' target='_blank'>
              <div class="icon icon-twitter"></div>
              <span class="sr-only">PouchDB's Twitter</span>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://github.com/rvagg/node-levelup' target='_blank'>
              <div class="icon icon-leveldb"></div>
              <span class="sr-only">Node Levelup</span>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://github.com/pouchdb/pouchdb' target='_blank'>
              <div class="icon icon-github"></div>
              <span class="sr-only">PouchDB's Github Repo</span>
            </a>
            </div>

          <div class='col-xs-4 col-md-offset-0 col-md-2'>
            <a href='https://travis-ci.org/pouchdb/pouchdb' target='_blank'>
              <div class="icon icon-travis"></div>
              <span class="sr-only">PouchDB's Travis CI</span>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='http://couchdb.apache.org/' target='_blank'>
              <div class="icon icon-couchdb"></div>
              <span class="sr-only">CouchDB</span>
            </a>
          </div>

          <div class='col-xs-4 col-md-2'>
            <a href='https://saucelabs.com' target='_blank'>
              <div class="icon icon-saucelabs"></div>
              <span class="sr-only">Saucelabs</span>
            </a>
          </div>

        </div>

      </div>

    </div>

    <footer class="footer">

      <div class="container">

        <div class="row">

          <div class='col-sm-3'>
            <h3 class="nav-head">Learn</h3>
            <ul class='nav nav-silent'>
              <li><a href="/getting-started.html">Getting Started</a></li>
              <li><a href="/api.html">API Guide</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/wiki">Wiki</a></li>
            </ul>
          </div>

          <div class='col-sm-3'>
            <h3 class="nav-head">Discuss</h3>
            <ul class='nav nav-silent'>
              <li><a href="https://groups.google.com/forum/#!forum/pouchdb">Mailing List</a></li>
              <li><a href="irc://freenode.net/#pouchdb">IRC</a></li>
              <li><a href="http://twitter.com/pouchdb">Twitter</a></li>
              <li><a href="http://stackoverflow.com/questions/tagged/pouchdb">StackOverflow</a></li>
            </ul>
          </div>

          <div class='col-sm-3'>
            <h3 class="nav-head">Contribute</h3>
            <ul class='nav nav-silent'>
              <li><a href="https://github.com/pouchdb/pouchdb/blob/master/CONTRIBUTING.md">Contributing</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb">Source</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/issues">Issues</a></li>
              <li><a href="https://github.com/pouchdb/pouchdb/blob/master/LICENSE">Apache License</a></li>
            </ul>
          </div>

        </div>

      </div>

    </footer>
    <script type="text/javascript" src="http://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/js/code.min.js"></script>
    <script type="text/javascript" src="/static/js/stickyfill.min.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/pouchdb/latest/pouchdb.min.js"></script>
    <script type="text/javascript">
      var $navSidebarWrapper = $('.nav-sidebar-wrapper');
      if ($navSidebarWrapper.length) {
        $navSidebarWrapper.Stickyfill();
      }
      $('[data-toggle="tooltip"]').tooltip();
      function onCached(e) {
        if (applicationCache.status === 1) {
          giveIntro();
        }
      }

      function giveIntro() {
        console.log('%c\n..............................................................................\n.?I...........~+: ............................................................\n.???.........++++.............................................................\n:????+......+++++.............................................................\n.??????+++++++++:.................................H...........D..B............\n...????++++++++...................................H...........D..B............\n...=????++++++.......PPPPP...OOOO...U....U...CCCC.HHHHH...DDDDD..BBBBB........\n...?????+++++++......P...:P.OO...O..U....U..C.....H...H..D....D..B....B.......\n..???????+++++++ ....P. ..P.O....O..U....U.CC.....H...H..D....D..B....B.......\n..?????????????......P...:P.OO...O..U....U..C.....H...H..D....D..B....B.......\n...I??????????~......PPPPP...OOOO...=UUUUU...CCCC.H...H...DDDDD..BBBBB........\n....?????????~.......P.... ...................................................\n.....???????+........P........................................................\n......??????..................................................................\n..............................................................................\n..............................................................................\n..............................................................................', 'color: #4ec084');
        console.log('%c\nPouchDB itself is hosted at PouchDB.com!\nTo get started, try typing:\nvar db = new PouchDB(\'mydb\');', 'color: #4ec084');
      }
      function offerToReload() {
        $('.js-update-notification')
          .removeClass('btn-update-hidden')
          .on('click', function(){
            window.location.reload();
          });
      }
      if (window.applicationCache) {
        applicationCache.addEventListener('cached', onCached, false);
        applicationCache.addEventListener('noupdate', giveIntro, false);
        applicationCache.addEventListener('updateready', offerToReload, false);
      }
    </script>
    <button type="button" class="js-update-notification btn btn-primary btn-update btn-update-hidden">
      Content updated, reload now? ↻
    </button>
  </body>
</html>
